If you're the author of a mod looking to incorporate the translation systems into your base mod, so foreign users do not need to download a translation mod for your mod, this is the file for you! Otherwise, go back to the [main README](README.md) and follow the appropriate link.

## What's this about a translation system?

Base AwSW Ren'Py is a sufficiently high version that it does support translations out of the box. However, the game's translation system is written under the assumption that only one translation will exist for each language. This is not the case for mods, where multiple translations of a line may exist for the same language.

To address this, the translation system in this repository provides a "python format" for string translations, which bypasses the Ren'Py string translation syntax and its check for non-duplicate strings. This format is the default format used for string translations in this repository, but it comes in two flavors: one to be inserted into a translation file and one to be loaded by a mod.

The distinction exists to allow mod load orders to function properly. Translation file loading is unordered, meaning nobody has control over which translations are installed first. By incorporating the translation system into your mod, you can ensure that your mod's translations are loaded _last_, (after any dependencies,) which allows you to provide fixups for any translations that may have been provided by other mods.

## How do I incorporate the translation system into my mod?

First, add the following function to your mod's `__init__.py`:

```py
def load_translations(mod_name):
    import io
    import os
    import os.path
    translations_path = os.path.join(modinfo.get_mod_path(mod_name), "resource/tl")
    # For each folder in the translations path, look for a `strings.py` file
    # If there are any non-folder files in the translations path, print a warn.
    if not os.path.exists(translations_path):
        print("{}: No translations folder found at {}".format(mod_name, translations_path))
        return
    for folder in os.listdir(translations_path):
        this_translation_path = os.path.join(translations_path, folder)
        if not os.path.isdir(this_translation_path):
            print("{} WARNING: {} is not a folder in {}".format(mod_name, folder, translations_path))
            continue
        strings_path = os.path.join(translations_path, folder, "strings.py")
        if os.path.exists(strings_path):
            try:
                infile = io.open(strings_path, "rb")
                compiled = compile(infile.read(), strings_path, 'exec')
                infile.close()
                exec(compiled)
                print("{}: Loaded translations for {}".format(mod_name, folder))
            except Exception as e:
                print("{} ERROR: Exception in {}:".format(mod_name, strings_path))
                print(e)
    else:
        print("{}: No translations found in {}".format(mod_name, translations_path))
```

Then, somewhere in your mod's `mod_load` or `mod_complete` functions, call it
with the name of your mod:

```py
    def mod_complete(self):
        ...
        load_translations(self.name)
        ...
```

This will load the `strings.py` files generated by this repository's translation tools and execute them, which will fill in any menu or interface strings with the translations provided by the translator.


## Converting `strings.rpy` to `strings.py`

If you're receiving translations from a third party, they likely generated their
translations as a `strings.rpy` file. What happens next depends on what's inside
that file:

- If the file contains Ren'Py-style translations, beginning with `translate languagetl strings:`, then you have a lot of manual work ahead to convert each entry to the python format. Sorry.
- If the file contains python-style translations, beginning with `init 1 python hide:`, then just replace that line with `def register_strings():`, add `import renpy` on the next line, and add a new line at the end of the file (with no indentation) calling the function: `register_strings()`. This will allow the file to be imported and executed by the translation system.
- If the file already begins with `def register_strings():`, then you're good to go! Just make sure the file is in the `resource/tl/languagetl` folder of your mod (with `languagetl` being the language ID from the file,) the file calls `register_strings()` at the end, and the file is named `strings.py`, and the translation system will pick it up.